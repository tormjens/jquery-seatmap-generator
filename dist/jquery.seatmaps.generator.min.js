/*
 *  jquery-seatmaps-generator - v1.0.0
 *  Easily create seatmaps
 *  http://tormorten.no
 *
 *  Made by Tor Morten Jensen
 *  Under MIT License
 */
!function(a){"use strict";function b(b,e){this.element=b,this.settings=a.extend({},d,e),a(this).data("state","0"),this._defaults=d,this._name=c,this.init()}var c="seatmap",d={rows:30,cols:30,data:[],classes:{container:"seatmap-container",row:"seatmap-row",column:"seatmap-col",controls:"seatmap-controls",states:{0:"default",1:"seat",2:"locked",3:"taken"}},containers:{controls:""},multiple:1,onUpdate:null,language:{delete_row:"Delete Row",delete_col:"Delete Column",new_row:"New Row",new_col:"New Column",clear_all:"Clear All",states:{0:"Standard",1:"Seat",2:"Locked",3:"Taken"}}};a.extend(b.prototype,{init:function(){a(this.element).addClass("seatmap-wrapper"),this.setupControls(),this.setupSeatmap()},setupSeatmap:function(){var b=this,c=a('<div class="'+this.settings.classes.container+'" />').appendTo(b.element),d=(a('<div class="seatmap-top-row"></div>').appendTo(c),this.settings.rows);0!==this.settings.data.length&&(d=this.settings.data.length);for(var e=0;d>e;e++)this.addRow(e,c);this.bindSeatmap()},addRow:function(b,c){var d=a('<div class="'+this.settings.classes.row+'"></div>').appendTo(c);d.attr("data-row",b);var e=this.settings.cols;0!==this.settings.data.length&&(e=this.settings.data[b].cols.length);for(var f=0;e>f;f++)this.addCol(f,d);return a('<button class="seatmap-delete-row" data-row="'+b+'" title="'+this.settings.language.delete_row+'">&times;</button>').appendTo(d),d},addCol:function(b,c){var d=a('<div class="'+this.settings.classes.column+'"></div>').appendTo(c);if(d.attr("data-col",b),d.attr("data-state","0"),0===c.data("row")){var e=a(this.element).find(".seatmap-top-row"),f=a('<button class="seatmap-delete-col" data-col="'+b+'" title="'+this.settings.language.delete_col+'">&times;</button>').appendTo(e);f.attr("data-col",b)}return d},setupControls:function(){var b;b=""===this.settings.containers.controls?this.element:this.settings.containers.controls,b=a('<div class="'+this.settings.classes.controls+'" />').appendTo(b),b.append('<button class="seatmap-controls-new-row">'+this.settings.language.new_row+"</button>"),b.append('<button class="seatmap-controls-new-col">'+this.settings.language.new_col+"</button>"),b.append('<button class="seatmap-controls-clear">'+this.settings.language.clear_all+"</button>");var c=a('<div class="seatmap-states" />').appendTo(b);c.append('<button class="seatmap-state-change" data-state="0">'+this.settings.language.states[0]+"</button>"),c.append('<button class="seatmap-state-change" data-state="1">'+this.settings.language.states[1]+"</button>"),c.append('<button class="seatmap-state-change" data-state="2">'+this.settings.language.states[2]+"</button>"),c.append('<button class="seatmap-state-change" data-state="3">'+this.settings.language.states[3]+"</button>"),this.bindControls(b)},bindSeatmap:function(){var b=this,c=a(this.element).find("."+this.settings.classes.container);if(this.settings.multiple){var d=!1;c.on("mousedown","."+this.settings.classes.column,function(){return d=!0,b.toggleSeat(a(this)),!1}).on("mouseover","."+this.settings.classes.column,function(){d&&b.toggleSeat(a(this))}),c.on("mouseup",function(){if(d=!1,"function"==typeof b.settings.onUpdate){var a=b.buildObject();b.settings.onUpdate.call(this,a)}})}},toggleSeat:function(b){var c=a(b).data("state");c=a(this).data("state");var d=this.settings.classes.states[c];a(b).toggleClass(d)},buildObject:function(){var b=this,c=[],d=a(b.element).find("."+b.settings.classes.row);return d.each(function(){var d=a(this).data("row"),e={row_id:d,cols:[]};a(this).find("."+b.settings.classes.column).each(function(){var b=a(this).data("col"),c=a(this).data("state");e.cols.push({col_id:b,state:c})}),c[d]=e}),c},getCurrentState:function(){return a(this).data("state")},changeState:function(b){a(this).data("state",b)},getNextRowNumber:function(){var b=a(this.element).find("."+this.settings.classes.row),c=[];return b.each(function(){c.push(a(this).data("row"))}),Math.max.apply(Math,c)+1},getNextColNumber:function(){var b=a(this.element).find("."+this.settings.classes.row).last(),c=b.find("."+this.settings.classes.column);console.log(b);var d=[];return c.each(function(){d.push(a(this).data("col"))}),Math.max.apply(Math,d)+1},updateRowIds:function(){var b=a(this.element).find("."+this.settings.classes.row),c=0;b.each(function(){var b=a(this);b.find(".seatmap-delete-row").attr("data-row",c),b.attr("data-row",c),c++})},updateColIds:function(){var b=this,c=a(this.element).find("."+this.settings.classes.row);c.each(function(){var c=a(this),d=c.find("."+b.settings.classes.column),e=0;d.each(function(){a(this).attr("data-col",e),e++})});var d=a(this.element).find(".seatmap-top-row"),e=0;d.find(".seatmap-delete-col").each(function(){a(this).attr("data-col",e),e++})},bindControls:function(b){var c=this;b.on("click",".seatmap-state-change",function(){a(".seatmap-state-change").not(this).removeClass("active"),a(this).toggleClass("active"),c.getCurrentState()===a(this).data("state")&&c.changeState("0"),c.changeState(a(this).data("state"))}),a(b).find('.seatmap-state-change[data-state="1"]').trigger("click"),b.on("click",".seatmap-controls-new-row",function(){var b=a(c.element).find("."+c.settings.classes.container),d=a(c.element).find("."+c.settings.classes.row).last().clone().appendTo(b);d.find("."+c.settings.classes.column).each(function(){a(this).removeClass(),a(this).addClass(c.settings.classes.column)});var e=c.getNextRowNumber();d.find(".seatmap-delete-row").attr("data-row",e),d.attr("data-row",e),c.bindSeatmap()}),b.on("click",".seatmap-controls-new-col",function(){var b=a(c.element).find("."+c.settings.classes.row);b.each(function(){var b=c.getNextColNumber(),d=a(this),e=d.find("."+c.settings.classes.column).last(),f=a('<div class="'+c.settings.classes.column+'"></div>').insertAfter(e);if(f.attr("data-col",b),f.attr("data-state","0"),0===d.data("row")){var g=a(c.element).find(".seatmap-top-row"),h=a('<button class="seatmap-delete-col" data-col="'+b+'" title="'+c.settings.language.delete_col+'">&times;</button>').appendTo(g);h.attr("data-col",b)}})}),a(c.element).on("click",".seatmap-delete-row",function(){a(this).parent().remove(),c.updateRowIds()}),a(c.element).on("click",".seatmap-delete-col",function(){a(c.element).find("."+c.settings.classes.column+'[data-col="'+a(this).data("col")+'"]').remove(),a(this).remove(),c.updateColIds()})}}),a.fn[c]=function(d,e){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})}}(jQuery,window,document);